language: python
dist: bionic
sudo: false
addons:
  postgresql: 9.6
  apt:
    packages:
      - postgresql-9.6-postgis-2.4
install: pip install tox coveralls
script: tox -e $TOX_ENV
after_success: coveralls
before_script:
    - cp t_overrides.travis.py t_overrides.py
    - psql -U postgres -c "DROP DATABASE IF EXISTS multigtfs"
    - psql -U postgres -c "CREATE DATABASE multigtfs"
    - psql -U postgres -d multigtfs -c "CREATE EXTENSION IF NOT EXISTS postgis; CREATE EXTENSION IF NOT EXISTS postgis_topology;"
matrix:
    include:
        - env: TOX_ENV=py36-django31-postgis
          python: "3.6"
        - env: TOX_ENV=py37-django31-postgis
          python: "3.7"
        - env: TOX_ENV=py38-django31-postgis
          python: "3.8"
        - env: TOX_ENV=py39-django31-postgis
          python: "3.9"
        - env: TOX_ENV=py36-django-master-postgis
          python: "3.6"
        - env: TOX_ENV=py37-django-master-postgis
          python: "3.7"
        - env: TOX_ENV=py38-django-master-postgis
          python: "3.8"
        - env: TOX_ENV=py39-django-master-postgis
          python: "3.9"
    allow_failures:
        # Django master is allowed to fail
        - env: TOX_ENV=py36-django-master-postgis
        - env: TOX_ENV=py37-django-master-postgis
        - env: TOX_ENV=py38-django-master-postgis
        - env: TOX_ENV=py39-django-master-postgis
